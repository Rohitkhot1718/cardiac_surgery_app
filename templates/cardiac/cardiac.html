<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cardiac Surgery Risk Assessment</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/static/css/style.css">

</head>

<body>

    {% include 'navbar.html' %}


    <div class="full-body">
        <div class="container">
            <h1 class="header text-white text-center">Cardiac Surgery Risk Assessment</h1>
            <div class="form-grid">
                <!-- Personal Information -->
                <div class="form-section">
                    <h4 class="section-title text-white">Personal Information</h4>
                    <div class="form-group">
                        <label>Name</label>
                        <input type="text" class="form-control" id="txtName" placeholder="Enter Your Name">
                    </div>
                    <div class="form-group">
                        <label>Age</label>
                        <input type="text" class="form-control" id="txtAge" placeholder="Enter Your Age">
                    </div>
                    <div class="form-group">
                        <label>Gender</label>
                        <select class="form-control" id="selGender" title="Gender">
                            <option value="">Select</option>
                            <option value="1">Male</option>
                            <option value="0">Female</option>
                        </select>
                    </div>
                </div>

                <!-- Medical Measurements -->
                <div class="form-section">
                    <h4 class="section-title text-white">Medical Measurements</h4>
                    <div class="form-group">
                        <label>Diabetes <span class="range-info">(70-126)</span></label>
                        <input type="text" class="form-control" id="selDiabetes" title="Diabetes" placeholder="Enter Diabetes Value">
                    </div>
                    <div class="form-group">
                        <label>Hypertension <span class="range-info">(90-180)</span></label>
                        <input type="text" class="form-control" id="selHypertension" title="Hypertension" placeholder="Enter Hypertension Value">
                    </div>
                    <div class="form-group">
                        <label>Kidney Disease <span class="range-info">(10-100)</span></label>
                        <input type="text" class="form-control" id="selKidneyDisease" title="Kidney Disease" placeholder="Enter Kidney Disease Value">
                    </div>
                    <div class="form-group">
                        <label>COPD <span class="range-info">(1-100)</span></label>
                        <input type="text" class="form-control" id="selRespiratoryIssues" title="Respiratory Issues" placeholder="Enter Respiratory Issues Value">
                    </div>
                    <div class="form-group">
                        <label>Ejection Fraction <span class="range-info">(30-70)</span></label>
                        <input type="text" class="form-control" id="selEjectionFraction" placeholder="Enter value">
                    </div>
                </div>

                <!-- Surgery Types -->
                <div class="form-section">
                    <h4 class="section-title text-white">Surgery Types</h4>
                    <div class="form-group">
                        <label>CABG</label>
                        <select class="form-control" id="selSurgeryTypeCABG" title="CABG Surgery Type">
                            <option value="">Select</option>
                            <option value="1">Yes</option>
                            <option value="0">No</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Valve</label>
                        <select class="form-control" id="selSurgeryTypeValve" title="Valve Surgery Type">
                            <option value="">Select</option>
                            <option value="1">Yes</option>
                            <option value="0">No</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Congenital</label>
                        <select class="form-control" id="selSurgeryTypeCongenita" title="Congenital Surgery Type">
                            <option value="">Select</option>
                            <option value="1">Yes</option>
                            <option value="0">No</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Aneurysm</label>
                        <select class="form-control" id="selSurgeryTypeAneurysm" title="Aneurysm Surgery Type">
                            <option value="">Select</option>
                            <option value="1">Yes</option>
                            <option value="0">No</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Transplant</label>
                        <select class="form-control" id="selSurgeryTypeTransplant" title="Transplant Surgery Type">
                            <option value="">Select</option>
                            <option value="1">Yes</option>
                            <option value="0">No</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="button">
                <button type="button" id="startPredicting" class="btn">Submit</button>
            </div>
        </div>
    </div>
</body>

</html>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
<script>

    function validateInput(value, min, max, fieldName) {
        const numValue = parseInt(value);
        if (isNaN(numValue) || numValue < min || numValue > max) {
            alert(`Please enter a valid ${fieldName} between ${min} and ${max}.`);
            return false;
        }
        return true;
    }

    $("#startPredicting").click(function () {
        if (!validateInput($("#txtAge").val(), 1, 110, "age")) return false;
        if ($("#selGender").val() === "") {
            alert("Please Select gender");
            return false;
        }
        if (!validateInput($("#selDiabetes").val(), 70, 130, "diabetes value")) return false;
        if (!validateInput($("#selHypertension").val(), 90, 180, "hypertension value")) return false;
        if (!validateInput($("#selKidneyDisease").val(), 10, 100, "kidney disease value")) return false;
        if (!validateInput($("#selRespiratoryIssues").val(), 1, 100, "respiratory issues value")) return false;
        if (!validateInput($("#selEjectionFraction").val(), 30, 70, "ejection fraction value")) return false;
        if ($("#selSurgeryTypeCABG").val() === "") {
            alert("Please Select surgerytypecabg");
            return false;
        }
        if ($("#selSurgeryTypeValve").val() === "") {
            alert("Please Select surgerytypevalve");
            return false;
        }
        if ($("#selSurgeryTypeCongenita").val() === "") {
            alert("Please Select surgerytypecongenita");
            return false;
        }
        if ($("#selSurgeryTypeAneurysm").val() === "") {
            alert("Please Select surgerytypeaneurysm");
            return false;
        }
        if ($("#selSurgeryTypeTransplant").val() === "") {
            alert("Please Select surgerytypetransplant");
            return false;
        }

        submitPatientData();
    });
    
    function submitPatientData() {
        const formData = {
            txtName: $("#txtName").val(),
            txtAge: $("#txtAge").val(),
            selGender: $("#selGender").val(),
            selDiabetes: $("#selDiabetes").val(),
            selHypertension: $("#selHypertension").val(),
            selKidneyDisease: $("#selKidneyDisease").val(),
            selRespiratoryIssues: $("#selRespiratoryIssues").val(),
            selEjectionFraction: $("#selEjectionFraction").val(),
            selSurgeryTypeCABG: $("#selSurgeryTypeCABG").val(),
            selSurgeryTypeValve: $("#selSurgeryTypeValve").val(),
            selSurgeryTypeCongenita: $("#selSurgeryTypeCongenita").val(),
            selSurgeryTypeAneurysm: $("#selSurgeryTypeAneurysm").val(),
            selSurgeryTypeTransplant: $("#selSurgeryTypeTransplant").val()
        };

        $.ajax({
            url: "/start_predict",
            type: "POST",
            contentType: "application/json",
            data: JSON.stringify(formData),
            success: function (response) {
                if (response.status === "success") {
                    window.location.href = `/prediction/?patient_id=${response.patient_id}`;
                } else {
                    alert("Error: " + response.error); 
                }
            },
            error: function () {
                alert("Failed to submit data. Try again.");
            }
        });
    }
</script>